# Example configuration for CS1237 ADC with Load Cell
#
# This file contains examples of configuring the CS1237 ADC chip
# for use with load cells and load_cell_probe in Klipper.
#
# The CS1237 is a 24-bit ADC specifically designed for load cell applications
# with built-in PGA (Programmable Gain Amplifier) and selectable data rates.
#
# CONFIGURATION BEHAVIOR:
# - Configuration is automatically written to the CS1237 chip on first data read after boot
# - Simply restart Klipper (RESTART or FIRMWARE_RESTART) to apply config changes
# - Manual configuration write: WRITE_CS1237_CONFIG command (for unnamed load_cell)
#   or WRITE_CS1237_CONFIG LOAD_CELL=<name> (for named load_cell)
#
# IMPORTANT NOTES:
# - Temperature mode (channel: TEMP) requires gain: 1 (automatically enforced)
# - Do not use ^ pullup prefix on dout_pin - this pin is bidirectional
# - SCLK and DOUT pins must be on the same MCU

# Example 1: Basic load cell configuration with CS1237
# This is the most common configuration for a load cell sensor
# Minimal configuration - only pins are required, rest use defaults
[load_cell my_load_cell]
sensor_type: cs1237
# Required: Data output pin (must be on same MCU as sclk_pin)
# Note: Do not use ^ prefix - this pin is bidirectional (input/output)
dout_pin: PB7
# Required: Serial clock pin (must be on same MCU as dout_pin)
sclk_pin: PB6
# Optional settings (these are the defaults, can be omitted):
#sample_rate: 640
#   Sample rate options: 10, 40, 640, or 1280 Hz
#   Higher rates give faster updates but may be noisier. Default: 640
#gain: 128
#   Gain options: 1, 2, 64, or 128
#   Higher gain for smaller signals (typical load cells use 128). Default: 128
#channel: A
#   Channel selection: A or TEMP
#   Use 'A' for normal load cell, 'TEMP' for temperature sensor
#   IMPORTANT: Temperature mode automatically forces gain to 1 (datasheet requirement)
#   Default: A

# Example 2: CS1237 with load_cell_probe for bed probing
# This configuration uses the CS1237 with Klipper's load_cell_probe
# for accurate Z-height measurements (using all default settings)
[load_cell_probe]
sensor_type: cs1237
dout_pin: PB7    # Bidirectional - do not use ^ prefix
sclk_pin: PB6
# All sensor options (sample_rate, gain, channel) use defaults
# sample_rate: 640 Hz is ideal for probing

# Load cell probe configuration
# Trigger force in grams - force required to trigger probe
trigger_force: 75
# Safety limit in grams - maximum force before error
force_safety_limit: 2000
# Time to collect samples for tare measurement
tare_time: 0.067

# Probe offset from nozzle (adjust to your setup)
x_offset: 0.0
y_offset: 0.0
#z_offset: 0.0  # Determined through PROBE_CALIBRATE

# Speed settings for probing moves
speed: 5.0
lift_speed: 10.0
samples: 3
sample_retract_dist: 2.0
samples_result: median
samples_tolerance: 0.010
samples_tolerance_retries: 3

# Continuous tare filter settings (optional, for advanced users)
# These filters help compensate for drift and vibration
#drift_filter_cutoff_frequency: 0.5
#buzz_filter_cutoff_frequency: 100.0
#notch_filter_frequencies: []

# Example 3: High-speed configuration for fast sampling
# Use this for applications requiring very fast data rates
[load_cell fast_sensor]
sensor_type: cs1237
dout_pin: PC5
sclk_pin: PC4
sample_rate: 1280  # Maximum sample rate
gain: 64           # Lower gain may be needed at high speeds
channel: A

# Example 4: Low-speed, high-precision configuration
# Use this for applications where precision is more important than speed
[load_cell precision_sensor]
sensor_type: cs1237
dout_pin: PA1
sclk_pin: PA0
sample_rate: 10    # Lowest sample rate for maximum stability
gain: 128          # Maximum gain for small signals
channel: A

# Example 5: Temperature monitoring with CS1237
# The CS1237 has a built-in temperature sensor
[load_cell temperature_monitor]
sensor_type: cs1237
dout_pin: PD2
sclk_pin: PD3
sample_rate: 40
gain: 1            # Lower gain for temperature readings
channel: TEMP      # Use temperature sensor channel

# Notes:
# 1. Pin Configuration:
#    - dout_pin and sclk_pin must be on the same MCU
#    - Do not use pullup (^) on dout_pin - pin is bidirectional
#    - Both pins should be capable of GPIO operation
#
# 2. Sample Rate Selection:
#    - 10 Hz: Very stable, good for high-precision static measurements
#    - 40 Hz: Good balance for most applications
#    - 640 Hz: Fast updates, suitable for dynamic measurements
#    - 1280 Hz: Maximum speed, may require lower gain
#
# 3. Gain Selection:
#    - Gain 1 or 2: For large signals or temperature measurements
#    - Gain 64: Good for moderate signals
#    - Gain 128: Maximum sensitivity for small signals (typical for load cells)
#
# 4. Calibration:
#    After configuration, you must calibrate your load cell using:
#    - LOAD_CELL_DIAGNOSTIC_MODE_ON (to start calibration mode)
#    - LOAD_CELL_TARE (to zero the sensor)
#    - LOAD_CELL_CALIBRATE GRAMS=<weight> (with known weight)
#    - SAVE_CONFIG (to save calibration)
#
# 5. Troubleshooting:
#    - If readings are unstable, try lowering the sample_rate
#    - If readings are too small, increase the gain
#    - If readings are saturated (stuck at min/max), decrease the gain
#    - Check wiring if you get communication errors
#
# 6. Compatibility:
#    - CS1237 is pin-compatible with HX711 but has different features
#    - Configuration is similar to HX711 but with different rate/gain options
#    - Can be used as a drop-in replacement in many applications

